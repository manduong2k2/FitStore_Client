<%- include('../includes/head.ejs') %>

<body onload="fetchDataAndBind()">
  <%- include('../includes/navigation.ejs') %>
  <style>
    .form-container {
      max-width: 600px;
      margin: 30px auto;
      padding: 20px;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }
    .btn {
      margin: 5px 0 5px 241.4px;
    }
    label {
      margin: 10px 0;
    }
  </style>
  <div class="container form-container">
    <h2>Product Form Edit</h2>
    <form id="productForm">
      <div class="form-group">
        <label for="productName">product Name:</label>
        <input
          type="text"
          class="form-control"
          id="productName"
          name="productName"
          required
        />
      </div>
      <div class="form-group">
        <label for="category">Category:</label>
        <select id="category" class="form-control" name="category" required></select
        ><br />
      </div>
      <div class="form-group">
        <label for="brand">Brand:</label>
        <select id="brand" class="form-control" name="brand" required></select
        ><br />
      </div>

      <div class="form-group">
        <label for="productImage">product Image:</label>
        <input
          type="file"
          class="form-control-file"
          id="productImage"
          name="productImage"
          accept="image/*"
          required
        />
      </div>
      <div class="form-group">
        <label for="productPrice">Product Price:</label>
        <input
          type="number"
          id="productPrice"
          name="productPrice"
          class="form-control"
          required
        /><br />
      </div>

      <div class="form-group">
        <label for="productInfo">product Info:</label>
        <textarea
          class="form-control"
          id="productInfo"
          name="productInfo"
          rows="4"
          required
        ></textarea>
      </div>
      <div class="form-group">
        <label for="productStock">Product Stock:</label>
        <input
          type="number"
          id="productStock"
          class="form-control"
          name="productStock"
          required
        /><br />
      </div>
      <button onclick="submitForm()" class="btn btn-success" >
        Submit
      </button>
    </form>
  </div>
  <script>
    function fetchDataAndBind() {
      fetch("http://jul2nd.ddns.net/category")
        .then((res) => res.json())
        .then((data) => {
          // Bind data to the category select element
          const categorySelect = document.getElementById("category");
          data.forEach((category) => {
            const option = document.createElement("option");
            option.value = category.id;
            option.textContent = category.name;
            categorySelect.appendChild(option);
          });
        })
        .catch((error) => console.error("Error fetching categories:", error));

      fetch("http://jul2nd.ddns.net/brand")
        .then((res) => res.json())
        .then((data) => {
          // Bind data to the brand select element
          const brandSelect = document.getElementById("brand");
          data.forEach((brand) => {
            const option = document.createElement("option");
            option.value = brand.id;
            option.textContent = brand.name;
            brandSelect.appendChild(option);
          });
        })
        .catch((error) => console.error("Error fetching brands:", error));
    }
  </script>
  <script>
    function submitForm() {
      var productName = document.getElementById("productName").value;
      var category = document.getElementById("category").value;
      var brand = document.getElementById("brand").value;
      var productImage = document.getElementById("productImage").files[0];
      var productPrice = document.getElementById("productPrice").value;
      var productInfo = document.getElementById("productInfo").value;
      var productStock = document.getElementById("productStock").value;

      const formData = new FormData();
      formData.append("name", productName);
      formData.append("category_id", category);
      formData.append("brand_id", brand);
      formData.append("price", productPrice);
      formData.append("info", productInfo);
      formData.append("stock", productStock);
      formData.append("image", productImage);

      fetch("http://jul2nd.ddns.net/product", {
        method: "POST",
        /* headers: {
                'Content-Type': 'multipart/form-data',
            }, */
        body: formData,
      })
        .then((res) => res.json())
        .then((data) => {
          console.log("Success:", data);
          // Handle success, e.g., show a success message to the user
                window.location.href = 'http://localhost:3000/';
        })
        .catch((error) => {
          console.error("Error:", error);
          // Handle errors, e.g., show an error message to the user
        });
    }
  </script>
  <%- include('../includes/footer.ejs') %>
</body>